<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.admin.mapper.TopStoreOrderMapper">

    <select id="selectInfoVO" resultType="com.ruoyi.admin.vo.OrderInfoVO">
        select
        sum(tso.amount) as amount,
        sum(IF(tso.`status` = 1,tso.income,0)) as redeem,
        sum(IF(tso.`status` = 2,tso.income,0)) as income
        from top_user tu inner join top_store_order tso on tu.id = tso.user_id
        <where>
            tu.wallet = #{walletAddress}
        </where>
    </select>

    <select id="selectPageVO" resultType="com.ruoyi.admin.vo.StoreOrderVO">
        select
            tso.*,
            ts.period
        from top_user tu
            inner join top_store_order tso on tu.id = tso.user_id
            inner join top_store ts on ts.id = tso.store_id
        <where>
            tu.wallet = #{walletAddress}
        </where>
        order by tso.id desc
    </select>

    <select id="lockByOrderNo" resultType="com.ruoyi.admin.entity.TopStoreOrder">
        select tso.*
        from top_store_order tso
        where tso.order_no = #{orderNo} for update
    </select>

</mapper>

